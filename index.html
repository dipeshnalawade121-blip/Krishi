<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Krishi Platform</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons for potential use -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom font import for better Devanagari rendering, though Inter is the default */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Noto+Sans+Devanagari:wght@400;700;900;800;900&display=swap');
        
        body {
            font-family: 'Inter', 'Noto Sans Devanagari', sans-serif;
            background-color: #f0fff0; /* Very light, almost white green */
            overflow-x: hidden; /* Prevent horizontal scroll on mobile */
        }
        
        /* Custom gradient for the top section to replicate the image's blur effect */
        .top-gradient {
            background: radial-gradient(circle at 50% 0%, rgba(199, 255, 199, 0.8) 0%, rgba(255, 255, 255, 0) 60%);
            height: 300px;
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 0;
        }

        /* Custom button styling for the Login button gradient */
        .login-button {
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            box-shadow: 0 4px 15px rgba(66, 165, 80, 0.5);
            transition: all 0.3s ease;
        }
        .login-button:hover {
             box-shadow: 0 6px 20px rgba(66, 165, 80, 0.7);
        }
        
        /* Custom button styling for the Register button */
        .register-button {
            background-color: white;
            border: 1px solid #C8E6C9; /* Light green border */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        /* Placeholder style for the instruction box to match the light, soft green */
        .instruction-box {
            background-color: rgba(220, 250, 220, 0.7); /* Slightly transparent light green */
            border: 1px solid rgba(200, 240, 200, 0.8);
            backdrop-filter: blur(2px);
        }

        /* Modal specific styling for animation */
        .modal-enter-active, .modal-leave-active {
            transition: opacity 0.3s ease;
        }
        .modal-enter-from, .modal-leave-to {
            opacity: 0;
        }
        .modal-content-enter-active, .modal-content-leave-active {
            transition: transform 0.3s ease;
        }
        .modal-content-enter-from, .modal-content-leave-to {
            transform: translateY(100%);
        }
        
    </style>
</head>
<body class="min-h-screen flex flex-col items-center">

    <!-- Top Gradient Effect -->
    <div class="top-gradient"></div>

    <!-- Main Content Container (fixed width for mobile app feel) -->
    <div class="relative z-10 w-full max-w-sm p-4">

        <!-- Header -->
        <header class="flex justify-between items-center py-4">
            <div class="text-xl font-bold text-green-700 flex items-center">
                <i data-lucide="leaf" class="w-6 h-6 mr-1 text-green-600"></i>
                krishi
            </div>
        </header>

        <!-- Title Section -->
        <div class="text-center mt-4 mb-10">
            <h1 class="text-8xl font-black text-gray-800" style="font-weight: 900;">कृषी</h1>
            <!-- Subtitle/Tagline (Visual placeholder for the text in the image) -->
            <p class="text-sm mt-3 text-gray-600 px-4">
                आपकी कृषी ज़रूरतों का डिजीटल केंद्र
            </p>
        </div>

        <!-- Instructions/Message Box -->
        <div class="instruction-box p-4 mt-8 rounded-2xl shadow-lg">
            <!-- Text replicated as a block of regional content -->
            <p class="text-xs leading-relaxed text-gray-700">
                नए उपयोगकर्ता: 'Register' पर क्लिक करें और अपनी जानकारी भरें। 
                मौजूदा उपयोगकर्ता: 'Login' पर क्लिक करके सीधे आगे बढ़ें। यह मंच किसानों और कृषी-केंद्रों के लिए है।
            </p>
            <p class="text-xs mt-2 text-gray-500 font-bold">
                 'Registration' / 'Login' process to access service.
            </p>
        </div>

        <!-- Login/Register Section -->
        <div class="mt-6 p-4 rounded-2xl">
            <!-- New User Register -->
            <div class="flex items-center justify-between mb-4">
                <p class="text-sm font-semibold text-gray-600 mr-4">New user:</p>
                <button 
                    class="register-button flex-grow py-3 px-6 text-green-700 font-bold rounded-full hover:bg-green-50"
                    onclick="openModal('registration-modal')">
                    Register
                </button>
            </div>

            <!-- Existing User Login -->
            <div class="flex items-center justify-between">
                <p class="text-sm font-semibold text-gray-600 mr-4">Existing user:</p>
                <button 
                    class="login-button flex-grow py-3 px-6 text-white font-bold rounded-full hover:shadow-xl"
                    onclick="openModal('login-modal')">
                    Login
                </button>
            </div>
        </div>

        <!-- --- USER FLOW STEPS --- -->
        <div class="mt-12 mb-8 w-full p-4 bg-white rounded-xl shadow-inner">
            <h2 class="text-lg font-extrabold text-center text-green-800 mb-6 uppercase tracking-wider">
                Digital Krishi Store in 4 Steps
            </h2>
            
            <!-- STEP 1: Create a Profile -->
            <div class="flex">
                <div class="flex flex-col items-center mr-6">
                    <div class="w-8 h-8 flex items-center justify-center rounded-full bg-green-500 text-white font-bold shadow-lg">1</div>
                    <div class="w-0.5 h-12 bg-green-300"></div>
                </div>
                <div class="pt-0.5 pb-4">
                    <h3 class="font-bold text-gray-800">Create a Profile</h3>
                    <p class="text-sm text-gray-500">Sign up and tell us about your farm or business.</p>
                </div>
            </div>
            
            <!-- STEP 2: Create a Digital Krishi Store -->
            <div class="flex">
                <div class="flex flex-col items-center mr-6">
                    <div class="w-8 h-8 flex items-center justify-center rounded-full bg-green-500 text-white font-bold shadow-lg">2</div>
                    <div class="w-0.5 h-12 bg-green-300"></div>
                </div>
                <div class="pt-0.5 pb-4">
                    <h3 class="font-bold text-gray-800">Create a Digital Krishi Store</h3>
                    <p class="text-sm text-gray-500">Add your products, seeds, or fertilizers to your digital catalog.</p>
                </div>
            </div>
            
            <!-- STEP 3: Publish Your Online Store -->
            <div class="flex">
                <div class="flex flex-col items-center mr-6">
                    <div class="w-8 h-8 flex items-center justify-center rounded-full bg-green-500 text-white font-bold shadow-lg">3</div>
                    <div class="w-0.5 h-12 bg-green-300"></div>
                </div>
                <div class="pt-0.5 pb-4">
                    <h3 class="font-bold text-gray-800">Publish Your Online Store</h3>
                    <p class="text-sm text-gray-500">Set shipping options and payment methods, then go live!</p>
                </div>
            </div>
            
            <!-- STEP 4: Your Digital Store Ready! -->
            <div class="flex">
                <div class="flex flex-col items-center mr-6">
                    <div class="w-8 h-8 flex items-center justify-center rounded-full bg-lime-600 text-white font-bold shadow-xl">
                         <i data-lucide="check" class="w-4 h-4"></i>
                    </div>
                </div>
                <div class="pt-0.5 pb-4">
                    <h3 class="font-extrabold text-lime-700">Your Digital Store Ready!</h3>
                    <p class="text-sm text-lime-600 font-medium">Manage orders, track sales, and grow your krishi business!</p>
                </div>
            </div>
        </div>
        <!-- --- END USER FLOW STEPS --- -->
        
    </div>

    <!-- ======================================================= -->
    <!-- Registration Modal (Hidden by default) -->
    <!-- ======================================================= -->
    <div id="registration-modal" class="hidden fixed inset-0 z-50 flex items-end justify-center bg-black bg-opacity-50" onclick="closeModal('registration-modal')">
        <div class="modal-content-leave-to w-full max-w-md bg-white rounded-t-3xl p-6 shadow-2xl transition-all duration-300 ease-in-out transform translate-y-0" onclick="event.stopPropagation()">
            
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-green-700">New User Registration</h2>
                <button class="text-gray-400 hover:text-red-500" onclick="closeModal('registration-modal')">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <form id="registration-form" class="space-y-4">
                <!-- Mobile Number & OTP -->
                <div class="flex space-x-2">
                    <input type="tel" id="reg-mobile" placeholder="Mobile Number" class="w-3/5 p-3 border border-green-200 rounded-xl focus:ring-green-500 focus:border-green-500" maxlength="10">
                    <button type="button" id="reg-send-otp" class="w-2/5 bg-green-100 text-green-700 font-semibold rounded-xl hover:bg-green-200 transition">Get OTP</button>
                </div>
                <div id="reg-recaptcha-container" style="display:none;"></div>
                
                <!-- OTP Input & Status -->
                <div class="flex space-x-2">
                    <input type="number" id="reg-otp" placeholder="Paste OTP" class="w-3/5 p-3 border border-green-200 rounded-xl focus:ring-green-500 focus:border-green-500" maxlength="6">
                    <button id="reg-verify-btn" type="button" class="w-2/5 bg-blue-100 text-blue-700 font-semibold rounded-xl hover:bg-blue-200 transition" disabled>Verify OTP</button>
                </div>

                <!-- Password Fields -->
                <input type="password" id="reg-password" placeholder="Create Password" class="w-full p-3 border border-green-200 rounded-xl focus:ring-green-500 focus:border-green-500">
                <input type="password" id="reg-password-confirm" placeholder="Confirm Password" class="w-full p-3 border border-green-200 rounded-xl focus:ring-green-500 focus:border-green-500">
                
                <!-- Submit Button -->
                <button type="submit" class="w-full py-3 mt-4 text-white font-bold rounded-xl login-button hover:shadow-xl">
                    Create Account
                </button>
            </form>

        </div>
    </div>
    
    <!-- ======================================================= -->
    <!-- Login Modal (Hidden by default) -->
    <!-- ======================================================= -->
    <div id="login-modal" class="hidden fixed inset-0 z-50 flex items-end justify-center bg-black bg-opacity-50" onclick="closeModal('login-modal')">
        <div class="modal-content-leave-to w-full max-w-md bg-white rounded-t-3xl p-6 shadow-2xl transition-all duration-300 ease-in-out transform translate-y-0" onclick="event.stopPropagation()">
            
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-green-700">Existing User Login</h2>
                <button class="text-gray-400 hover:text-red-500" onclick="closeModal('login-modal')">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <form id="login-form" class="space-y-4">
                <!-- Registered Mobile Number -->
                <input type="tel" id="login-mobile" placeholder="Registered Mo. No." class="w-full p-3 border border-green-200 rounded-xl focus:ring-green-500 focus:border-green-500" maxlength="10">
                <div id="login-recaptcha-container" style="display:none;"></div>
                
                <!-- Password Option -->
                <input type="password" id="login-password" placeholder="Password" class="w-full p-3 border border-green-200 rounded-xl focus:ring-green-500 focus:border-green-500">
                
                <!-- OR Divider -->
                <div class="flex items-center">
                    <div class="flex-grow border-t border-gray-300"></div>
                    <span class="flex-shrink mx-4 text-gray-500 text-sm font-semibold">OR</span>
                    <div class="flex-grow border-t border-gray-300"></div>
                </div>

                <!-- OTP Option (Placeholder for getting OTP if not using password) -->
                <div class="flex space-x-2">
                    <input type="number" id="login-otp" placeholder="Enter OTP" class="w-3/5 p-3 border border-green-200 rounded-xl focus:ring-green-500 focus:border-green-500" maxlength="6">
                    <button type="button" id="login-send-otp" class="w-2/5 bg-green-100 text-green-700 font-semibold rounded-xl hover:bg-green-200 transition">Get New OTP</button>
                </div>
                <button id="login-verify-btn" type="button" class="w-full py-3 bg-blue-500 text-white font-semibold rounded-xl hover:bg-blue-600 disabled:bg-gray-400 transition" disabled style="display: none;">Verify OTP</button>
                
                <!-- Submit Button -->
                <button type="submit" class="w-full py-3 mt-4 text-white font-bold rounded-xl login-button hover:shadow-xl">
                    Login
                </button>
            </form>
        </div>
    </div>


    <!-- Initialize Lucide Icons and Modal Logic -->
    <script>
        lucide.createIcons();
        
        // Function to open the specified modal
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Prevent scrolling the background
        }

        // Function to close the specified modal
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.add('hidden');
            document.body.style.overflow = ''; // Restore scrolling
            if (modalId === 'registration-modal') {
                resetRegistration();
            } else if (modalId === 'login-modal') {
                resetLogin();
            }
        }

        // Handle ESC key to close modals
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal('registration-modal');
                closeModal('login-modal');
            }
        });

        function resetRegistration() {
            document.getElementById('registration-form').reset();
            const sendBtn = document.getElementById('reg-send-otp');
            sendBtn.textContent = 'Get OTP';
            sendBtn.className = 'w-2/5 bg-green-100 text-green-700 font-semibold rounded-xl hover:bg-green-200 transition';
            sendBtn.disabled = false;
            const verifyBtn = document.getElementById('reg-verify-btn');
            verifyBtn.innerHTML = 'Verify OTP';
            verifyBtn.className = 'w-2/5 bg-blue-100 text-blue-700 font-semibold rounded-xl hover:bg-blue-200 transition';
            verifyBtn.disabled = true;
            document.getElementById('reg-otp').disabled = false;
            if (window.regInterval) {
                clearInterval(window.regInterval);
                delete window.regInterval;
            }
            window.regConfirmation = null;
            window.regVerified = false;
        }

        function resetLogin() {
            document.getElementById('login-form').reset();
            const sendBtn = document.getElementById('login-send-otp');
            sendBtn.textContent = 'Get New OTP';
            sendBtn.className = 'w-2/5 bg-green-100 text-green-700 font-semibold rounded-xl hover:bg-green-200 transition';
            sendBtn.disabled = false;
            const verifyBtn = document.getElementById('login-verify-btn');
            verifyBtn.style.display = 'none';
            verifyBtn.innerHTML = 'Verify OTP';
            verifyBtn.className = 'w-full py-3 bg-blue-500 text-white font-semibold rounded-xl hover:bg-blue-600 disabled:bg-gray-400 transition';
            verifyBtn.disabled = true;
            document.getElementById('login-otp').disabled = false;
            if (window.loginInterval) {
                clearInterval(window.loginInterval);
                delete window.loginInterval;
            }
            window.loginConfirmation = null;
            window.loginVerified = false;
        }

    </script>

    <script type="module">
    // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-analytics.js";
    import { getAuth, RecaptchaVerifier, signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyC7s02po42gQ-frJT2G6wfvGa-zLysTAVQ",
      authDomain: "myotpapp-50067.firebaseapp.com",
      projectId: "myotpapp-50067",
      storageBucket: "myotpapp-50067.firebasestorage.app",
      messagingSenderId: "489896198277",
      appId: "1:489896198277:web:c911e919fc7b59556c69ec",
      measurementId: "G-FTY81KQE5S"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth(app);

    // Recaptcha Verifiers
        window.regVerifier = new RecaptchaVerifier(auth, 'reg-recaptcha-container', {
            'size': 'invisible'
        });
        window.loginVerifier = new RecaptchaVerifier(auth, 'login-recaptcha-container', {
            'size': 'invisible'
        });

    window.regVerifier.render();
    window.loginVerifier.render();

    window.regConfirmation = null;
    window.loginConfirmation = null;
    window.regVerified = false;
    window.loginVerified = false;

    const regOriginalClass = 'w-2/5 bg-green-100 text-green-700 font-semibold rounded-xl hover:bg-green-200 transition';
    const loginOriginalClass = 'w-2/5 bg-green-100 text-green-700 font-semibold rounded-xl hover:bg-green-200 transition';

    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    function startCountdown(btn, seconds, originalText, originalClass, intervalKey, confirmationVar) {
      if (window[intervalKey]) {
        clearInterval(window[intervalKey]);
      }
      btn.disabled = true;
      const timerSpan = document.createElement('span');
      timerSpan.id = 'timer-span';
      timerSpan.className = 'ml-1 font-medium';
      btn.innerHTML = 'OTP sent successfully! ';
      btn.appendChild(timerSpan);
      timerSpan.innerHTML = formatTime(seconds);
      btn.className = 'w-2/5 flex items-center justify-center rounded-xl bg-blue-100 text-blue-700 text-sm font-medium border border-blue-300 p-1';
      let timeLeft = seconds;
      window[intervalKey] = setInterval(() => {
        timeLeft--;
        timerSpan.innerHTML = formatTime(timeLeft);
        if (timeLeft < 0) {
          clearInterval(window[intervalKey]);
          delete window[intervalKey];
          btn.innerHTML = originalText;
          btn.className = originalClass;
          btn.disabled = false;
          window[confirmationVar] = null;
        }
      }, 1000);
    }

    // Registration Send OTP
    document.getElementById('reg-send-otp').addEventListener('click', async () => {
      const phoneInput = document.getElementById('reg-mobile').value.replace(/[^0-9]/g, '');
      if (phoneInput.length !== 10) {
        alert('Please enter a valid 10-digit mobile number.');
        return;
      }
      if (window.regConfirmation) {
        return;
      }
      const phoneNumber = '+91' + phoneInput;
      const sendBtn = document.getElementById('reg-send-otp');
      try {
        window.regConfirmation = await signInWithPhoneNumber(auth, phoneNumber, window.regVerifier);
        startCountdown(sendBtn, 119, 'Get OTP', regOriginalClass, 'regInterval', 'regConfirmation');
        alert('OTP sent to your mobile!');
      } catch (error) {
        console.error(error);
        alert('Error sending OTP: ' + error.message);
      }
    });

    // Registration OTP Input Listener
    document.getElementById('reg-otp').addEventListener('input', (e) => {
      const value = e.target.value;
      const verifyBtn = document.getElementById('reg-verify-btn');
      if (window.regConfirmation && value.length === 6 && /^\d{6}$/.test(value)) {
        verifyBtn.disabled = false;
      } else {
        verifyBtn.disabled = true;
      }
    });

    // Registration Verify OTP
    document.getElementById('reg-verify-btn').addEventListener('click', async () => {
      const code = document.getElementById('reg-otp').value;
      if (!window.regConfirmation) return;
      try {
        const result = await window.regConfirmation.confirm(code);
        const verifyBtn = document.getElementById('reg-verify-btn');
        verifyBtn.innerHTML = 'Verified <i data-lucide="check" class="w-3 h-3 ml-1"></i>';
        verifyBtn.className = 'w-2/5 flex items-center justify-center rounded-xl bg-green-100 text-green-700 text-sm font-medium border border-green-300';
        verifyBtn.disabled = true;
        document.getElementById('reg-otp').disabled = true;
        document.getElementById('reg-otp').value = '';
        lucide.createIcons();
        alert('Phone number verified successfully!');
        window.regVerified = true;
        console.log('Verified user:', result.user);
      } catch (error) {
        console.error(error);
        alert('Invalid OTP. Please try again.');
        document.getElementById('reg-otp').value = '';
        document.getElementById('reg-verify-btn').disabled = true;
      }
    });

    // Registration Form Submit
    document.getElementById('registration-form').addEventListener('submit', (e) => {
      e.preventDefault();
      if (!window.regVerified) {
        alert('Please verify your phone number first.');
        return;
      }
      const pw1 = document.getElementById('reg-password').value;
      const pw2 = document.getElementById('reg-password-confirm').value;
      if (pw1.length < 6 || pw1 !== pw2) {
        alert('Passwords must match and be at least 6 characters.');
        return;
      }
      alert('Account created successfully! Welcome to Krishi.');
      resetRegistration();
      closeModal('registration-modal');
    });

    // Login Send OTP
    document.getElementById('login-send-otp').addEventListener('click', async () => {
      const phoneInput = document.getElementById('login-mobile').value.replace(/[^0-9]/g, '');
      if (phoneInput.length !== 10) {
        alert('Please enter a valid 10-digit mobile number.');
        return;
      }
      if (window.loginConfirmation) {
        return;
      }
      const phoneNumber = '+91' + phoneInput;
      const sendBtn = document.getElementById('login-send-otp');
      try {
        window.loginConfirmation = await signInWithPhoneNumber(auth, phoneNumber, window.loginVerifier);
        startCountdown(sendBtn, 119, 'Get New OTP', loginOriginalClass, 'loginInterval', 'loginConfirmation');
        document.getElementById('login-verify-btn').style.display = 'block';
        alert('OTP sent to your mobile!');
      } catch (error) {
        console.error(error);
        alert('Error sending OTP: ' + error.message);
      }
    });

    // Login OTP Input Listener
    document.getElementById('login-otp').addEventListener('input', (e) => {
      const value = e.target.value;
      const verifyBtn = document.getElementById('login-verify-btn');
      if (window.loginConfirmation && value.length === 6 && /^\d{6}$/.test(value)) {
        verifyBtn.disabled = false;
      } else {
        verifyBtn.disabled = true;
      }
    });

    // Login Verify OTP
    document.getElementById('login-verify-btn').addEventListener('click', async () => {
      const code = document.getElementById('login-otp').value;
      if (!window.loginConfirmation) return;
      try {
        const result = await window.loginConfirmation.confirm(code);
        const verifyBtn = document.getElementById('login-verify-btn');
        verifyBtn.innerHTML = 'Verified <i data-lucide="check" class="w-3 h-3 ml-1"></i>';
        verifyBtn.className = 'w-full py-3 flex items-center justify-center rounded-xl bg-green-100 text-green-700 font-semibold border border-green-300';
        verifyBtn.disabled = true;
        document.getElementById('login-otp').disabled = true;
        document.getElementById('login-otp').value = '';
        lucide.createIcons();
        alert('Phone number verified successfully!');
        window.loginVerified = true;
        console.log('Verified user:', result.user);
      } catch (error) {
        console.error(error);
        alert('Invalid OTP. Please try again.');
        document.getElementById('login-otp').value = '';
        document.getElementById('login-verify-btn').disabled = true;
      }
    });

    // Login Form Submit
    document.getElementById('login-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const pw = document.getElementById('login-password').value;
      if (pw || window.loginVerified) {
        alert('Logged in successfully!');
        resetLogin();
        closeModal('login-modal');
      } else {
        alert('Enter password or verify OTP.');
      }
    });

    </script>
</body>
</html>
