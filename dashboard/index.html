<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>рдлрд╛рд░реНрдо рд╢реЙрдк | [Your Shop Name] - рдЯреЗрдореНрдкрд▓реЗрдЯ</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the app's overall look */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
        /* Customizing Tailwind config for a consistent green theme */
        :root {
            /* Primary Green - Used for accents, buttons, links, etc. */
            --primary-green: #38A169;
            /* Header/Dark Theme Color (for high contrast text) */
            --dark-green: #1B4D3E;
        }
        .text-primary { color: var(--primary-green); }
        .bg-primary { background-color: var(--primary-green); }
        .bg-dark-green { background-color: var(--dark-green); }
        .border-primary { border-color: var(--primary-green); }

        /* Custom Vertical Gradient: Dark Forest Green to Emerald (Mango Leaf Vibe) */
        .bg-agri-gradient {
            background-image: linear-gradient(to bottom, #004D40, #00A050); 
        }

        /* Hide scrollbars but allow scrolling */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        
        /* Specific style for selected category button in modal */
        .category-select-btn.selected {
            background-color: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#38A169', // Custom Green Accent
                        'agri-dark': '#1B4D3E', // Custom Dark Green for Text
                    }
                }
            }
        }
    </script>
</head>
<body>

    <!-- Main Container - Centered and Responsive -->
    <div class="max-w-xl mx-auto bg-white shadow-xl min-h-screen flex flex-col">

        <!-- 1. TOP HEADER BAR -->
        <header class="bg-agri-gradient sticky top-0 z-10 shadow-lg">
            <div id="header-content" class="flex items-center justify-between p-3">
                
                <!-- Shop Name and Logo/Leaf Icon -->
                <div id="shop-logo-name" class="flex items-center space-x-2 flex-shrink-0">
                    <span class="text-white text-xl">&#127807;</span> 
                    <h1 class="text-lg font-bold text-white">
                        [Your Shop Name]
                    </h1>
                </div>

                <!-- Dynamic Right Side Content (Address OR Sticky Search) -->
                <div id="header-dynamic-right" class="flex items-center justify-end w-2/3 ml-2">
                    
                    <!-- 1. Address Button (Visible at top) -->
                    <button id="address-btn-compact" class="text-sm font-semibold text-white/90 hover:text-white transition w-full text-right" onclick="showAddressModal()">
                        [City], [Pincode]
                    </button>
                    
                    <!-- 2. Compact Search Bar (Hidden at top, appears on scroll) -->
                    <div id="sticky-search-compact" class="relative hidden w-full">
                        <input type="text" placeholder="рдЙрддреНрдкрд╛рджрдиреЗ рд╢реЛрдзрд╛..." 
                               class="w-full py-1.5 pl-8 pr-2 rounded-lg focus:outline-none focus:ring-1 focus:ring-white focus:border-white text-sm shadow-md text-gray-800"
                               onfocus="this.placeholder='рд╢реЛрдзрдгреНрдпрд╛рд╕рд╛рдареА рдЯрд╛рдЗрдк рдХрд░рд╛...'" 
                               onblur="this.placeholder='рдЙрддреНрдкрд╛рджрдиреЗ рд╢реЛрдзрд╛...'">
                        <!-- Search Icon -->
                        <svg class="absolute left-2 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </div>
                </div>
            </div>
        </header>

        <!-- 1.5. PRIMARY SEARCH BAR SECTION (SCROLLS AWAY) -->
        <section id="primary-search-section" class="p-3 pt-2 pb-2 bg-white shadow-sm">
            <div class="relative">
                <input type="text" placeholder="рдЙрддреНрдкрд╛рджрди рд╢реЛрдзрд╛ (Search Products)..." 
                       class="w-full py-2 pl-10 pr-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary text-sm shadow-inner"
                       onfocus="this.placeholder='рд╢реЛрдзрдгреНрдпрд╛рд╕рд╛рдареА рдЯрд╛рдЗрдк рдХрд░рд╛...'" 
                       onblur="this.placeholder='рдЙрддреНрдкрд╛рджрди рд╢реЛрдзрд╛ (Search Products)...'">
                <!-- Search Icon -->
                <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>
        </section>

        <!-- 1.6. ADDED: BROAD LINE SEPARATOR -->
        <div class="h-2 bg-agri-gradient shadow-md"></div>
        
        <!-- Main Content Area -->
        <main class="flex-grow bg-[#f1f1f1]">
            
            <!-- 2. SLIDING BANNER SECTION (NOW CLICKABLE) -->
            <section class="p-3">
                <!-- Added cursor-pointer and onclick to open the new modal -->
                <div class="relative overflow-hidden rounded-lg shadow-md bg-gray-100 h-48 sm:h-64 cursor-pointer" onclick="openBannerModal()">
                    
                    <!-- Slider Content -->
                    <div id="banner-slider" class="flex transition-transform duration-500 ease-in-out h-full">
                        <div id="slide-1" class="min-w-full flex flex-col items-center justify-center bg-primary text-white text-center p-4">
                            <h2 class="text-xl font-extrabold mb-1">рдкрд╣рд┐рд▓рд╛ рдмреЕрдирд░: рдореЛрдареА рдСрдлрд░!</h2>
                            <p class="text-sm font-medium">рдпреЗрдереЗ рддреБрдордЪреНрдпрд╛ **рд╕рд░реНрд╡рд╛рдд рдореЛрдареНрдпрд╛ рд╕рд┐рдЭрди рдСрдлрд░** рдЪрд╛ рдлреЛрдЯреЛ рдЕрдкрд▓реЛрдб рдХрд░рд╛.</p>
                            <p class="text-xs mt-1 opacity-80">(рдЙрджрд╛. 'рджрд┐рд╡рд╛рд│реА рдСрдлрд░', 'рдирд╡реАрди рдорд╛рд▓ рдЖрд▓рд╛')</p>
                        </div>
                        <div id="slide-2" class="min-w-full flex flex-col items-center justify-center bg-yellow-600 text-white text-center p-4">
                             <h2 class="text-xl font-extrabold mb-1">рджреБрд╕рд░рд╛ рдмреЕрдирд░: рдЦрд╛рд╕ рдЙрддреНрдкрд╛рджрди!</h2>
                            <p class="text-sm font-medium">рдпреЗрдереЗ рддреБрдордЪреНрдпрд╛ **рд╕рд░реНрд╡рд╛рдзрд┐рдХ рд╡рд┐рдХрд▓реНрдпрд╛ рдЬрд╛рдгрд╛рд▒реНрдпрд╛ рдЙрддреНрдкрд╛рджрдирд╛рдЪрд╛** рдлреЛрдЯреЛ рдЕрдкрд▓реЛрдб рдХрд░рд╛.</p>
                            <p class="text-xs mt-1 opacity-80">(рдпреЗрдереЗ рдЬрд╛рд╕реНрддреАрдд рдЬрд╛рд╕реНрдд реи рдмреЕрдирд░ рдареЗрд╡рд╛)</p>
                        </div>
                        <div id="slide-3" class="min-w-full flex flex-col items-center justify-center bg-blue-600 text-white text-center p-4">
                             <h2 class="text-xl font-extrabold mb-1">рддрд┐рд╕рд░рд╛ рдмреЕрдирд░: рд╕реВрдЪрдирд╛!</h2>
                            <p class="text-sm font-medium">рдпреЗрдереЗ рд╢реЗрддреАрдмрджреНрджрд▓рдЪреНрдпрд╛ **рдорд╣рддреНрддреНрд╡рд╛рдЪреНрдпрд╛ рд╕реВрдЪрдирд╛рдВрдЪрд╛** рдмреЕрдирд░ рдЬреЛрдбрд╛.</p>
                            <p class="text-xs mt-1 opacity-80">(рдЙрджрд╛. 'рд╣рд╡рд╛рдорд╛рди рдЕрдВрджрд╛рдЬ', 'рдирд╡реАрди рдирд┐рдпрдо')</p>
                        </div>
                    </div>

                    <!-- Slider Controls -->
                    <button onclick="event.stopPropagation(); changeSlide(-1);" class="absolute top-1/2 left-2 transform -translate-y-1/2 bg-black/30 p-2 rounded-full text-white hover:bg-black/50 transition z-10">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <button onclick="event.stopPropagation(); changeSlide(1);" class="absolute top-1/2 right-2 transform -translate-y-1/2 bg-black/30 p-2 rounded-full text-white hover:bg-black/50 transition z-10">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7"></path></svg>
                    </button>

                    <!-- Dots Indicators -->
                    <div id="slider-dots" class="absolute bottom-2 left-0 right-0 flex justify-center space-x-2">
                        <!-- Dots will be generated by JS -->
                    </div>
                </div>
            </section>

            <!-- 3. CATEGORY NAVIGATION (рдмреАрдЬ, рд╕рдВрд░рдХреНрд╖рдг, рд╣рд╛рд░реНрдбрд╡реЗрдЕрд░, рдкреЛрд╖рдг) -->
            <section class="p-3 pt-0">
                <p class="text-sm text-center text-gray-600 mb-2 font-medium">рдкреНрд░рддреНрдпреЗрдХ рд╡рд░реНрдЧрд╛рдд **рдЙрддреНрдкрд╛рджрдиреЗ рдЬреЛрдбрдгреНрдпрд╛рд╕рд╛рдареА** рдЦрд╛рд▓реА рдХреНрд▓рд┐рдХ рдХрд░рд╛.</p>
                <div class="flex justify-between space-x-2 hide-scrollbar overflow-x-auto pb-2">
                    
                    <!-- Category 1: рдмреАрдЬ (Seed) -->
                    <button class="category-btn group flex-shrink-0 w-1/4 max-w-[100px] flex flex-col items-center p-2 rounded-lg bg-white shadow-md hover:shadow-lg transition transform hover:scale-[1.02]" data-category="рдмреАрдЬ">
                        <div class="p-3 mb-1 bg-yellow-100 rounded-full border border-yellow-300 group-hover:bg-primary/20 transition">
                            <span class="text-2xl" role="img" aria-label="Seed">ЁЯМ▒</span>
                        </div>
                        <span class="text-sm font-medium text-gray-800">рдмреАрдЬ</span>
                        <span class="text-xs text-primary/80 font-semibold mt-1 hidden group-hover:block transition duration-300">рдЙрддреНрдкрд╛рджрдиреЗ рдЬреЛрдбрд╛</span>
                    </button>

                    <!-- Category 2: рд╕рдВрд░рдХреНрд╖рдг (Protection) -->
                    <button class="category-btn group flex-shrink-0 w-1/4 max-w-[100px] flex flex-col items-center p-2 rounded-lg bg-white shadow-md hover:shadow-lg transition transform hover:scale-[1.02]" data-category="рд╕рдВрд░рдХреНрд╖рдг">
                        <div class="p-3 mb-1 bg-red-100 rounded-full border border-red-300 group-hover:bg-primary/20 transition">
                             <span class="text-2xl" role="img" aria-label="Protection">ЁЯЫбя╕П</span>
                        </div>
                        <span class="text-sm font-medium text-gray-800">рд╕рдВрд░рдХреНрд╖рдг</span>
                        <span class="text-xs text-primary/80 font-semibold mt-1 hidden group-hover:block transition duration-300">рдЙрддреНрдкрд╛рджрдиреЗ рдЬреЛрдбрд╛</span>
                    </button>
                    
                    <!-- Category 3: рд╣рд╛рд░реНрдбрд╡реЗрдЕрд░ (Hardware) -->
                    <button class="category-btn group flex-shrink-0 w-1/4 max-w-[100px] flex flex-col items-center p-2 rounded-lg bg-white shadow-md hover:shadow-lg transition transform hover:scale-[1.02]" data-category="рд╣рд╛рд░реНрдбрд╡реЗрдЕрд░">
                        <div class="p-3 mb-1 bg-blue-100 rounded-full border border-blue-300 group-hover:bg-primary/20 transition">
                             <span class="text-2xl" role="img" aria-label="Hardware">ЁЯЫая╕П</span>
                        </div>
                        <span class="text-sm font-medium text-gray-800">рд╣рд╛рд░реНрдбрд╡реЗрдЕрд░</span>
                        <span class="text-xs text-primary/80 font-semibold mt-1 hidden group-hover:block transition duration-300">рдЙрддреНрдкрд╛рджрдиреЗ рдЬреЛрдбрд╛</span>
                    </button>
                    
                    <!-- Category 4: рдкреЛрд╖рдг (Nutrition) -->
                    <button class="category-btn group flex-shrink-0 w-1/4 max-w-[100px] flex flex-col items-center p-2 rounded-lg bg-white shadow-md hover:shadow-lg transition transform hover:scale-[1.02]" data-category="рдкреЛрд╖рдг">
                        <div class="p-3 mb-1 bg-green-100 rounded-full border border-green-300 group-hover:bg-primary/20 transition">
                             <span class="text-2xl" role="img" aria-label="Nutrition">ЁЯзк</span>
                        </div>
                        <span class="text-sm font-medium text-gray-800">рдкреЛрд╖рдг</span>
                        <span class="text-xs text-primary/80 font-semibold mt-1 hidden group-hover:block transition duration-300">рдЙрддреНрдкрд╛рджрдиреЗ рдЬреЛрдбрд╛</span>
                    </button>
                </div>
            </section>

            <!-- 4.5. ADD PRODUCT MANAGEMENT SECTION (NEW) - MOVED HERE -->
            <section class="p-3 bg-[#f1f1f1]">
                <h2 class="text-lg font-semibold text-agri-dark mb-3 flex items-center justify-between">
                    рдЙрддреНрдкрд╛рджрди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди (Product Management)
                    <span id="product-count" class="text-sm font-normal text-gray-500">0/50 рдЙрддреНрдкрд╛рджрдиреЗ</span>
                </h2>

                <!-- Add Product Card (Clickable to open Modal) -->
                <div onclick="openAddProductModal()" 
                     class="bg-white p-4 rounded-xl shadow-lg mb-4 flex items-center justify-between border-2 border-dashed border-primary/50 cursor-pointer hover:bg-green-50 transition transform hover:scale-[1.01]">
                    <div class="flex items-center">
                        <span class="text-3xl text-primary font-bold mr-3">+</span>
                        <p class="text-lg font-medium text-agri-dark">рдирд╡реАрди рдЙрддреНрдкрд╛рджрди рдЬреЛрдбрд╛</p>
                    </div>
                    <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                </div>

                <!-- Products Display Column (Horizontal Scroll) -->
                <div id="product-list-container" class="flex space-x-4 pb-2 hide-scrollbar overflow-x-scroll">
                    <!-- Product cards will be inserted here by JavaScript -->
                    <div id="product-list-placeholder" class="text-center text-gray-500 p-4 w-full flex-shrink-0 bg-white rounded-lg shadow-inner">
                        <p class="text-sm">рддреБрдордЪреА рдЬреЛрдбрд▓реЗрд▓реА рдЙрддреНрдкрд╛рджрдиреЗ рдпреЗрдереЗ рджрд┐рд╕рддреАрд▓. 'рдирд╡реАрди рдЙрддреНрдкрд╛рджрди рдЬреЛрдбрд╛' рд╡рд░ рдХреНрд▓рд┐рдХ рдХрд░рд╛.</p>
                    </div>
                </div>
            </section>
            
            <!-- 4. FEATURED PRODUCTS (рдЦрд╛рд╕ рдЙрддреНрдкрд╛рджрдиреЗ) - MOVED HERE -->
            <section class="p-3">
                <h2 class="text-lg font-semibold text-agri-dark mb-3">рдЦрд╛рд╕ рдЙрддреНрдкрд╛рджрдиреЗ (Featured Products)</h2>
                
                <div class="grid grid-cols-2 gap-3">
                    
                    <!-- Featured Product 1 (Placeholder) -->
                    <div class="product-card bg-white rounded-lg shadow-md overflow-hidden flex flex-col items-center justify-center h-40 p-3 border-2 border-dashed border-primary/50 text-center hover:shadow-lg transition">
                        <span class="text-4xl text-primary mb-2">+</span>
                        <p class="text-sm font-medium text-agri-dark">рдЙрддреНрдкрд╛рджрди рез рдирд┐рд╡рдбрд╛</p>
                        <p class="text-xs text-gray-500">(рдмреАрдЬ/рд╕рдВрд░рдХреНрд╖рдг/рд╣рд╛рд░реНрдбрд╡реЗрдЕрд░/рдкреЛрд╖рдг рдордзреВрди)</p>
                    </div>

                    <!-- Featured Product 2 (Placeholder) -->
                    <div class="product-card bg-white rounded-lg shadow-md overflow-hidden flex flex-col items-center justify-center h-40 p-3 border-2 border-dashed border-primary/50 text-center hover:shadow-lg transition">
                        <span class="text-4xl text-primary mb-2">+</span>
                        <p class="text-sm font-medium text-agri-dark">рдЙрддреНрдкрд╛рджрди реи рдирд┐рд╡рдбрд╛</p>
                        <p class="text-xs text-gray-500">(рдЙрддреНрдкрд╛рджрди рдмрджрд▓рдгреНрдпрд╛рд╕рд╛рдареА рдХреНрд▓рд┐рдХ рдХрд░рд╛)</p>
                    </div>

                    <!-- Featured Product 3 (Placeholder) -->
                    <div class="product-card bg-white rounded-lg shadow-md overflow-hidden flex flex-col items-center justify-center h-40 p-3 border-2 border-dashed border-primary/50 text-center hover:shadow-lg transition">
                        <span class="text-4xl text-primary mb-2">+</span>
                        <p class="text-sm font-medium text-agri-dark">рдЙрддреНрдкрд╛рджрди рей рдирд┐рд╡рдбрд╛</p>
                        <p class="text-xs text-gray-500">(рд╣реЗ рдЙрддреНрдкрд╛рджрди рдиреЗрд╣рдореА рд╕рдореЛрд░ рджрд┐рд╕реЗрд▓)</p>
                    </div>

                    <!-- Featured Product 4 (Placeholder) -->
                    <div class="product-card bg-white rounded-lg shadow-md overflow-hidden flex flex-col items-center justify-center h-40 p-3 border-2 border-dashed border-primary/50 text-center hover:shadow-lg transition">
                        <span class="text-4xl text-primary mb-2">+</span>
                        <p class="text-sm font-medium text-agri-dark">рдЙрддреНрдкрд╛рджрди рек рдирд┐рд╡рдбрд╛</p>
                        <p class="text-xs text-gray-500">(рддреБрдордЪреНрдпрд╛ рдЖрд╡рдбреАрдиреБрд╕рд╛рд░ рдмрджрд▓рд╛)</p>
                    </div>

                </div>
            </section>
        </main>
        
        <!-- 5. FOOTER SECTION -->
        <footer class="bg-agri-gradient text-white pt-6 pb-2 mt-4 rounded-t-lg shadow-inner">
            <div class="px-4">
                
                <!-- Contact Information -->
                <div class="mb-4">
                    <h3 class="text-lg font-bold text-white mb-2">рдЖрдордЪреНрдпрд╛рд╢реА рд╕рдВрдкрд░реНрдХ рд╕рд╛рдзрд╛</h3>
                    <div class="space-y-1 text-sm text-gray-100">
                        <p class="flex items-center">
                            <svg class="w-4 h-4 mr-2 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
                            рдкрддреНрддрд╛: [Full Shop Address Line 1]
                        </p>
                        <p class="flex items-center">
                            <svg class="w-4 h-4 mr-2 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C10.83 21 3 13.17 3 4c0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.46.57 3.57.11.35.03.75-.24 1.02l-2.2 2.2z"/></svg>
                            рдлреЛрди: [Shop Mobile Number]
                        </p>
                        <p class="flex items-center">
                            <svg class="w-4 h-4 mr-2 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14H9v-2h2v2zm3 0h-2v-2h2v2zm-3-3H9V9h2v4zm3 0h-2V9h2v4z"/></svg>
                            рд╡реНрд╣реЙрдЯреНрд╕ре▓рдк: [WhatsApp Number]
                        </p>
                    </div>
                </div>

                <!-- Quick Links (Professional touch) -->
                <div class="border-t border-white/40 pt-3 mt-3">
                    <h3 class="text-sm font-semibold text-white mb-2">рдорд╣рддреНрддреНрд╡рд╛рдЪреА рдорд╛рд╣рд┐рддреА</h3>
                    <ul class="flex flex-wrap text-xs text-gray-200">
                        <li class="mr-3"><a href="#" class="hover:text-white transition">рдЖрдордЪреНрдпрд╛рдмрджреНрджрд▓</a></li>
                        <li class="mr-3"><a href="#" class="hover:text-white transition">рдЧреЛрдкрдиреАрдпрддрд╛ рдзреЛрд░рдг</a></li>
                        <li class="mr-3"><a href="#" class="hover:text-white transition">рд╡рд╛рдкрд░ рдЕрдЯреА</a></li>
                        <li class="mr-3"><a href="#" class="hover:text-white transition">рд░рд┐рдЯрд░реНрди рдкреЙрд▓рд┐рд╕реА</a></li>
                    </ul>
                </div>
            </div>

            <!-- Copyright and Rights Reserved -->
            <div class="text-center text-xs text-white/70 border-t border-white/40 mt-4 pt-2 px-4">
                &copy; 2024 [Your Shop Name]. рд╕рд░реНрд╡ рд╣рдХреНрдХ рд░рд╛рдЦреАрд╡. (All Rights Reserved).
            </div>
        </footer>


        <!-- Full Address Modal (Hidden by Default) -->
        <div id="address-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
            <div class="bg-white rounded-lg p-6 shadow-2xl w-full max-w-sm">
                <h3 class="text-xl font-bold mb-3 text-agri-dark">рд╕рдВрдкреВрд░реНрдг рдкрддреНрддрд╛ (Full Address)</h3>
                <p class="text-gray-700 mb-4">
                    **[Your Shop Name]**<br>
                    Plot No. 123, New Market Yard,<br>
                    Main Road, Near Bus Stand,<br>
                    [City], Maharashtra, [Pincode]
                </p>
                <!-- Button uses primary color -->
                <button onclick="document.getElementById('address-modal').classList.add('hidden')" class="w-full bg-primary text-white py-2 rounded-lg font-semibold hover:bg-green-700 transition">
                    рдмрдВрдж рдХрд░рд╛
                </button>
            </div>
        </div>


        <!-- ADD PRODUCT MODAL (UPDATED FOR FILE UPLOAD) -->
        <div id="add-product-modal" class="fixed inset-0 bg-gray-900 bg-opacity-70 z-50 hidden flex items-center justify-center p-4" onclick="if(event.target === this) closeAddProductModal()">
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto p-6 transition-all duration-300">
                <h3 class="text-2xl font-bold mb-4 text-agri-dark">рдирд╡реАрди рдЙрддреНрдкрд╛рджрди рдЬреЛрдбрд╛</h3>
                
                <form id="add-product-form" class="space-y-4">
                    
                    <!-- Add Image File Upload Input (MODIFIED) -->
                    <div class="border-b pb-4 border-gray-200">
                        <label class="block text-lg font-bold text-gray-800 mb-2">рдЙрддреНрдкрд╛рджрди рдлреЛрдЯреЛ (Upload Photo)</label>
                        <!-- Image Preview Area -->
                        <div id="product-img-preview" class="h-20 w-full bg-gray-100 mb-2 rounded-lg border border-dashed border-gray-400 flex items-center justify-center overflow-hidden">
                            <img id="product-img-tag" src="" class="hidden w-full h-full object-cover">
                            <span id="product-img-text" class="text-xs text-gray-500">рдлреЛрдЯреЛ рдирд┐рд╡рдбрд╛ (Max 100KB)</span>
                        </div>
                        <input type="file" id="product-img-file" accept="image/*" required class="mt-1 block w-full text-sm text-gray-700">
                        <p class="text-xs text-red-600 mt-1 font-medium">
                            **рдорд╣рддреНрддреНрд╡рд╛рдЪреЗ:** рдХреГрдкрдпрд╛ рдлрдХреНрдд **100KB** рдкрд░реНрдпрдВрддрдЪрд╛ рдлреЛрдЯреЛ рдЕрдкрд▓реЛрдб рдХрд░рд╛.
                        </p>
                    </div>

                    <!-- Product Name Input -->
                    <div>
                        <label for="product-name" class="block text-sm font-medium text-gray-700">рдЙрддреНрдкрд╛рджрдирд╛рдЪреЗ рдирд╛рд╡ (Product Name)</label>
                        <input type="text" id="product-name" required maxlength="50"
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"
                               placeholder="рдЙрджрд╛. рд╕рд┐рдЬреЗрдВрдЯрд╛ рд╕реЛрдпрд╛рдмреАрди рдмрд┐рдпрд╛рдгреЗ">
                    </div>

                    <!-- Product Price Input -->
                    <div>
                        <label for="product-price" class="block text-sm font-medium text-gray-700">рдХрд┐рдВрдордд (Price - тВ╣)</label>
                        <input type="number" id="product-price" required min="1" step="0.01"
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"
                               placeholder="тВ╣ 1500.00">
                    </div>

                    <!-- Product Description Textarea -->
                    <div>
                        <label for="product-description" class="block text-sm font-medium text-gray-700">рдЙрддреНрдкрд╛рджрдирд╛рдЪреЗ рд╡рд░реНрдгрди (Description)</label>
                        <textarea id="product-description" rows="3" required maxlength="300"
                                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm resize-none"
                                  placeholder="рдЙрддреНрдкрд╛рджрдирд╛рдЪреА рдорд╛рд╣рд┐рддреА, рдлрд╛рдпрджреЗ, рдЙрдкрдпреЛрдЧ рдЖрдгрд┐ рд╡рд╛рдкрд░рдгреНрдпрд╛рдЪреА рдкрджреНрдзрдд."></textarea>
                    </div>

                    <!-- Category Selection -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">рдЙрддреНрдкрд╛рджрди рд╡рд░реНрдЧ (Category)</label>
                        <div id="category-options" class="flex flex-wrap gap-2">
                            <button type="button" data-category="рдмреАрдЬ" class="category-select-btn px-4 py-2 text-sm font-medium rounded-full border border-gray-300 bg-gray-100 text-gray-700 hover:bg-primary/20 transition duration-150">рдмреАрдЬ</button>
                            <button type="button" data-category="рд╕рдВрд░рдХреНрд╖рдг" class="category-select-btn px-4 py-2 text-sm font-medium rounded-full border border-gray-300 bg-gray-100 text-gray-700 hover:bg-primary/20 transition duration-150">рд╕рдВрд░рдХреНрд╖рдг</button>
                            <button type="button" data-category="рд╣рд╛рд░реНрдбрд╡реЗрдЕрд░" class="category-select-btn px-4 py-2 text-sm font-medium rounded-full border border-gray-300 bg-gray-100 text-gray-700 hover:bg-primary/20 transition duration-150">рд╣рд╛рд░реНрдбрд╡реЗрдЕрд░</button>
                            <button type="button" data-category="рдкреЛрд╖рдг" class="category-select-btn px-4 py-2 text-sm font-medium rounded-full border border-gray-300 bg-gray-100 text-gray-700 hover:bg-primary/20 transition duration-150">рдкреЛрд╖рдг</button>
                            <input type="hidden" id="product-category" required>
                        </div>
                    </div>

                    <!-- Save Button -->
                    <button type="submit" id="save-product-btn" 
                            class="w-full bg-primary text-white py-2.5 rounded-lg font-semibold text-lg shadow-md hover:bg-green-700 transition transform hover:scale-[1.01]">
                        рдЙрддреНрдкрд╛рджрди рдЬрддрди рдХрд░рд╛ (Save)
                    </button>
                </form>
            </div>
        </div>

        <!-- BANNER MANAGEMENT MODAL (UNCHANGED) -->
        <div id="banner-modal" class="fixed inset-0 bg-gray-900 bg-opacity-70 z-50 hidden flex items-center justify-center p-4" onclick="if(event.target === this) closeBannerModal()">
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto p-6 transition-all duration-300">
                <h3 class="text-2xl font-bold mb-4 text-agri-dark">рдмреЕрдирд░ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди (Manage Banners)</h3>
                
                <p class="text-sm text-red-600 font-semibold mb-4 bg-red-50 p-3 rounded-lg border border-red-200">
                    <span class="font-bold">рдорд╣рддреНрддреНрд╡рд╛рдЪреА рд╕реВрдЪрдирд╛:</span> рдХреГрдкрдпрд╛ рдлреЛрдЯреЛ рдЕрдкрд▓реЛрдб рдХрд░рд╛. рдкреНрд░рддреНрдпреЗрдХ рдлреЛрдЯреЛрдЪрд╛ рдЖрдХрд╛рд░ **рдЬрд╛рд╕реНрддреАрдд рдЬрд╛рд╕реНрдд 100KB** рдЕрд╕рд╛рд╡рд╛!
                </p>

                <form id="banner-form" class="space-y-6">
                    
                    <!-- Banner 1 Input -->
                    <div class="border-b pb-4 border-gray-200">
                        <label class="block text-lg font-bold text-gray-800 mb-2">рдмреЕрдирд░ рез (рдореЛрдареА рдСрдлрд░)</label>
                        <!-- Image Preview Area -->
                        <div id="banner-1-preview" class="h-20 w-full bg-gray-100 mb-2 rounded-lg border border-dashed border-gray-400 flex items-center justify-center overflow-hidden">
                            <img id="banner-1-img" src="" class="hidden w-full h-full object-cover">
                            <span id="banner-1-text" class="text-xs text-gray-500">рдлреЛрдЯреЛ рдирд┐рд╡рдбрд╛ (Select Photo)</span>
                        </div>
                        <input type="file" id="banner-1-file" accept="image/*" class="mt-1 block w-full text-sm text-gray-700">
                    </div>

                    <!-- Banner 2 Input -->
                    <div class="border-b pb-4 border-gray-200">
                        <label class="block text-lg font-bold text-gray-800 mb-2">рдмреЕрдирд░ реи (рдЦрд╛рд╕ рдЙрддреНрдкрд╛рджрди)</label>
                        <!-- Image Preview Area -->
                         <div id="banner-2-preview" class="h-20 w-full bg-gray-100 mb-2 rounded-lg border border-dashed border-gray-400 flex items-center justify-center overflow-hidden">
                            <img id="banner-2-img" src="" class="hidden w-full h-full object-cover">
                            <span id="banner-2-text" class="text-xs text-gray-500">рдлреЛрдЯреЛ рдирд┐рд╡рдбрд╛ (Select Photo)</span>
                        </div>
                        <input type="file" id="banner-2-file" accept="image/*" class="mt-1 block w-full text-sm text-gray-700">
                    </div>

                    <!-- Banner 3 Input -->
                    <div>
                        <label class="block text-lg font-bold text-gray-800 mb-2">рдмреЕрдирд░ рей (рд╕реВрдЪрдирд╛/рд╣рд╡рд╛рдорд╛рди)</label>
                        <!-- Image Preview Area -->
                         <div id="banner-3-preview" class="h-20 w-full bg-gray-100 mb-2 rounded-lg border border-dashed border-gray-400 flex items-center justify-center overflow-hidden">
                            <img id="banner-3-img" src="" class="hidden w-full h-full object-cover">
                            <span id="banner-3-text" class="text-xs text-gray-500">рдлреЛрдЯреЛ рдирд┐рд╡рдбрд╛ (Select Photo)</span>
                        </div>
                        <input type="file" id="banner-3-file" accept="image/*" class="mt-1 block w-full text-sm text-gray-700">
                    </div>

                    <!-- Save Button -->
                    <button type="submit" 
                            class="w-full bg-primary text-white py-2.5 rounded-lg font-semibold text-lg shadow-md hover:bg-green-700 transition transform hover:scale-[1.01]">
                        рдмреЕрдирд░ рдЬрддрди рдХрд░рд╛
                    </button>
                    
                </form>
            </div>
        </div>

        <!-- Custom Message Box (Instead of alert) -->
        <div id="message-box" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-agri-dark text-white px-4 py-2 rounded-full shadow-xl transition-opacity duration-300 opacity-0 pointer-events-none z-50"></div>

    </div>

    <script type="module">
        // --- FIREBASE IMPORTS ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, addDoc, onSnapshot, collection, setDoc, updateDoc, deleteDoc, getDocs, query, limit, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- GLOBAL ENVIRONMENT VARIABLES (MANDATORY) ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        const PRODUCT_LIMIT = 50;
        const BANNER_MAX_SIZE = 102400; // 100KB in bytes for file upload validation
        const PRODUCTS_COLLECTION_PATH = (userId) => `/artifacts/${appId}/users/${userId}/products`;
        
        // --- FIREBASE INSTANCES ---
        let app, db, auth;
        let userId = null;
        let isAuthReady = false;

        // --- UTILITY: Message Box (Instead of alert) ---
        function showMessage(message, duration = 3000) {
            const box = document.getElementById('message-box');
            box.textContent = message;
            box.classList.remove('opacity-0', 'pointer-events-none');
            box.classList.add('opacity-100');
            setTimeout(() => {
                box.classList.remove('opacity-100');
                box.classList.add('opacity-0', 'pointer-events-none');
            }, duration);
        }

        // --- INITIALIZATION AND AUTHENTICATION ---
        async function initializeFirebase() {
            try {
                if (firebaseConfig) {
                    app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);
                    setLogLevel('Debug');

                    onAuthStateChanged(auth, async (user) => {
                        if (user) {
                            userId = user.uid;
                            isAuthReady = true;
                            setupFirestoreListener();
                            console.log("Firebase Auth Ready. User ID:", userId);
                        } else {
                            // Initial sign-in attempt
                            try {
                                if (initialAuthToken) {
                                    await signInWithCustomToken(auth, initialAuthToken);
                                } else {
                                    await signInAnonymously(auth);
                                }
                            } catch (error) {
                                console.error("Firebase Sign-In failed:", error);
                                userId = crypto.randomUUID(); // Fallback to anonymous ID
                                isAuthReady = true;
                                setupFirestoreListener();
                            }
                        }
                    });

                    // Ensure sign-in happens immediately if token is present
                    if (!auth.currentUser) {
                        if (initialAuthToken) {
                            await signInWithCustomToken(auth, initialAuthToken);
                        } else {
                            await signInAnonymously(auth);
                        }
                    }
                } else {
                    showMessage("Firebase config missing. Persistence disabled.");
                    isAuthReady = true; // Still allow app functions to run
                }
            } catch (error) {
                console.error("Error initializing Firebase:", error);
                showMessage("Firebase initialization error.");
                isAuthReady = true;
            }
        }
        
        // Helper function to read file and perform size validation (100KB) - PRODUCT VERSION
        // This is necessary because the product image is REQUIRED for submission.
        function readAndValidateProductFile(fileInput) {
            return new Promise((resolve, reject) => {
                const file = fileInput.files[0];
                
                // 1. Check if a file was selected (Product image is required)
                if (!file) {
                    return reject(new Error("рдХреГрдкрдпрд╛ рдЙрддреНрдкрд╛рджрдирд╛рдЪрд╛ рдлреЛрдЯреЛ рдирд┐рд╡рдбрд╛."));
                }

                // 2. Size Validation (100KB limit)
                if (file.size > BANNER_MAX_SIZE) {
                    return reject(new Error(`рдлреЛрдЯреЛрдЪрд╛ рдЖрдХрд╛рд░ 100KB рдкреЗрдХреНрд╖рд╛ рдЬрд╛рд╕реНрдд рдЖрд╣реЗ. (Max size 100KB)`));
                }

                // 3. Read File as Data URL (Base64)
                const reader = new FileReader();

                reader.onload = (e) => {
                    resolve(e.target.result); // Resolve with Data URL
                };

                reader.onerror = () => {
                    reject(new Error("рдлрд╛рдЗрд▓ рд╡рд╛рдЪрдгреНрдпрд╛рдд рддреНрд░реБрдЯреА рдЖрд▓реА."));
                };

                reader.readAsDataURL(file);
            });
        }


        // --- PRODUCT MANAGEMENT FUNCTIONS (UPDATED) ---
        const addProductModal = document.getElementById('add-product-modal');
        const addProductForm = document.getElementById('add-product-form');
        const productListContainer = document.getElementById('product-list-container');
        let currentProducts = [];

        window.openAddProductModal = function() {
            if (currentProducts.length >= PRODUCT_LIMIT) {
                showMessage(`рддреБрдореНрд╣реА рдЬрд╛рд╕реНрддреАрдд рдЬрд╛рд╕реНрдд ${PRODUCT_LIMIT} рдЙрддреНрдкрд╛рджрдиреЗ рдЬреЛрдбрд▓реА рдЖрд╣реЗрдд. (Limit Reached)`);
                return;
            }
            addProductForm.reset();
            document.querySelectorAll('.category-select-btn').forEach(btn => btn.classList.remove('selected'));
            document.getElementById('product-category').value = '';
            
            // NEW: Reset file input preview
            document.getElementById('product-img-tag').src = '';
            document.getElementById('product-img-tag').classList.add('hidden');
            document.getElementById('product-img-text').classList.remove('hidden');

            addProductModal.classList.remove('hidden');
        }

        window.closeAddProductModal = function() {
            addProductModal.classList.add('hidden');
        }
        
        // Category Selection Logic
        document.querySelectorAll('.category-select-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('.category-select-btn').forEach(btn => btn.classList.remove('selected'));
                e.currentTarget.classList.add('selected');
                document.getElementById('product-category').value = e.currentTarget.getAttribute('data-category');
            });
        });

        // Form Submission Handler (MODIFIED FOR FILE UPLOAD)
        addProductForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('product-name').value.trim();
            const price = parseFloat(document.getElementById('product-price').value);
            const description = document.getElementById('product-description').value.trim();
            const category = document.getElementById('product-category').value;

            let imgDataUrl = 'https://placehold.co/150x150/38A169/ffffff?text=рдЙрддреНрдкрд╛рджрди'; // Placeholder fallback

            if (!name || isNaN(price) || !description || !category) {
                showMessage("рдХреГрдкрдпрд╛ рд╕рд░реНрд╡ рдлреАрд▓реНрдб рднрд░рд╛. (Please fill all fields)");
                return;
            }

            if (currentProducts.length >= PRODUCT_LIMIT) {
                showMessage(`рдЙрддреНрдкрд╛рджрди рдорд░реНрдпрд╛рджрд╛ (${PRODUCT_LIMIT}) рдЧрд╛рдард▓реА рдЖрд╣реЗ! (Limit Reached)`);
                return;
            }
            
            // NEW: Process the uploaded file
            try {
                const fileInput = document.getElementById('product-img-file');
                // Validate and read file, will throw error if size is too large or file is missing
                imgDataUrl = await readAndValidateProductFile(fileInput); 
            } catch (error) {
                showMessage(`рдлреЛрдЯреЛ рдЕрдкрд▓реЛрдб рддреНрд░реБрдЯреА: ${error.message}`, 5000);
                return; // Stop submission if file validation fails
            }

            const newProduct = {
                name,
                price,
                description,
                category,
                imgUrl: imgDataUrl, // Use the base64 URL
                createdAt: Date.now()
            };

            await saveProduct(newProduct);
        });
        
        // Save to Firestore (UNCHANGED)
        async function saveProduct(product) {
            if (!db || !userId) {
                showMessage("Database рддрдпрд╛рд░ рдирд╛рд╣реА. (DB not ready)");
                return;
            }
            try {
                // Use a query to check the current count before saving
                const q = query(collection(db, PRODUCTS_COLLECTION_PATH(userId)), limit(PRODUCT_LIMIT));
                const snapshot = await getDocs(q);
                
                if (snapshot.size >= PRODUCT_LIMIT) {
                    showMessage(`рдЙрддреНрдкрд╛рджрди рдорд░реНрдпрд╛рджрд╛ (${PRODUCT_LIMIT}) рдЧрд╛рдард▓реА рдЖрд╣реЗ! (Limit Reached)`);
                    closeAddProductModal();
                    return;
                }
                
                await addDoc(collection(db, PRODUCTS_COLLECTION_PATH(userId)), product);
                closeAddProductModal();
                showMessage(`'${product.name}' рдпрд╢рд╕реНрд╡реАрд░рд┐рддреНрдпрд╛ рдЬреЛрдбрд▓реЗ! (Successfully Added)`);
            } catch (error) {
                console.error("Error adding document: ", error);
                showMessage("рдЙрддреНрдкрд╛рджрди рдЬреЛрдбрддрд╛рдирд╛ рддреНрд░реБрдЯреА рдЖрд▓реА. (Error adding product)");
            }
        }
        
        // Render Products to UI (UNCHANGED)
        function renderProducts(products) {
            currentProducts = products;
            productListContainer.innerHTML = ''; // Clear existing cards
            
            document.getElementById('product-count').textContent = `${products.length}/${PRODUCT_LIMIT} рдЙрддреНрдкрд╛рджрдиреЗ`;

            if (products.length === 0) {
                productListContainer.innerHTML = `
                    <div id="product-list-placeholder" class="text-center text-gray-500 p-4 w-full flex-shrink-0 bg-white rounded-lg shadow-inner">
                        <p class="text-sm">рддреБрдордЪреА рдЬреЛрдбрд▓реЗрд▓реА рдЙрддреНрдкрд╛рджрдиреЗ рдпреЗрдереЗ рджрд┐рд╕рддреАрд▓. 'рдирд╡реАрди рдЙрддреНрдкрд╛рджрди рдЬреЛрдбрд╛' рд╡рд░ рдХреНрд▓рд┐рдХ рдХрд░рд╛.</p>
                    </div>
                `;
                return;
            }

            products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'w-40 flex-shrink-0 bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200 hover:shadow-xl transition transform hover:scale-[1.03] cursor-pointer';
                
                card.innerHTML = `
                    <div class="h-24 bg-gray-100 overflow-hidden">
                        <img src="${product.imgUrl}" onerror="this.onerror=null;this.src='https://placehold.co/160x100/38A169/ffffff?text=${product.category}'" alt="${product.name}" class="w-full h-full object-cover">
                    </div>
                    <div class="p-3">
                        <div class="text-xs font-semibold text-primary/80 mb-1">${product.category}</div>
                        <h4 class="text-sm font-bold text-agri-dark truncate mb-1" title="${product.name}">${product.name}</h4>
                        <p class="text-lg font-extrabold text-green-700">тВ╣${product.price.toFixed(2)}</p>
                        <p class="text-xs text-gray-500 mt-1 line-clamp-2">${product.description}</p>
                    </div>
                `;
                productListContainer.appendChild(card);
            });
        }
        
        // Firestore Listener (UNCHANGED)
        function setupFirestoreListener() {
            if (!db || !userId) return;

            const q = collection(db, PRODUCTS_COLLECTION_PATH(userId));
            
            onSnapshot(q, (snapshot) => {
                let productsData = [];
                snapshot.forEach(doc => {
                    productsData.push({ id: doc.id, ...doc.data() });
                });

                // Sort the data in-memory by creation date (newest first), as orderBy() is avoided.
                productsData.sort((a, b) => b.createdAt - a.createdAt);

                renderProducts(productsData.slice(0, PRODUCT_LIMIT));
            }, (error) => {
                console.error("Firestore Listener Error: ", error);
                showMessage("рдЙрддреНрдкрд╛рджрдиреЗ рд▓реЛрдб рдХрд░рддрд╛рдирд╛ рддреНрд░реБрдЯреА рдЖрд▓реА. (Error loading products)");
            });
        }

        // --- BANNER MANAGEMENT MODAL FUNCTIONS (UNCHANGED) ---
        const bannerModal = document.getElementById('banner-modal');
        const bannerForm = document.getElementById('banner-form');

        // Helper function to update the banner image preview in the modal (UNCHANGED)
        function setBannerPreview(idPrefix, dataUrl) {
            const imgEl = document.getElementById(`${idPrefix}-img`);
            const textEl = document.getElementById(`${idPrefix}-text`);

            if (dataUrl) {
                imgEl.src = dataUrl;
                imgEl.classList.remove('hidden');
                textEl.classList.add('hidden');
            } else {
                imgEl.src = '';
                imgEl.classList.add('hidden');
                textEl.classList.remove('hidden');
            }
        }
        
        // Helper function to read file and perform size validation (100KB) (UNCHANGED)
        function processFile(fileInput, storageKey) {
            return new Promise((resolve, reject) => {
                const file = fileInput.files[0];
                
                // 1. Check if no file was selected (user skipped this banner)
                if (!file) {
                    return resolve(null); // No file selected, skip update for this banner
                }

                // 2. Size Validation (100KB limit)
                if (file.size > BANNER_MAX_SIZE) {
                    // Reject the promise with a specific error message
                    return reject(new Error(`Banner size for ${file.name} is too large. Max size is 100KB.`));
                }

                // 3. Read File as Data URL (Base64)
                const reader = new FileReader();

                reader.onload = (e) => {
                    resolve({ key: storageKey, dataUrl: e.target.result });
                };

                reader.onerror = () => {
                    reject(new Error("File reading failed."));
                };

                reader.readAsDataURL(file);
            });
        }

        window.openBannerModal = function() {
            // Load Base64 data from local storage (using new keys)
            const dataUrl1 = localStorage.getItem('banner_1_dataurl') || '';
            const dataUrl2 = localStorage.getItem('banner_2_dataurl') || '';
            const dataUrl3 = localStorage.getItem('banner_3_dataurl') || '';

            // Set modal preview images
            setBannerPreview('banner-1', dataUrl1);
            setBannerPreview('banner-2', dataUrl2);
            setBannerPreview('banner-3', dataUrl3);
            
            // Clear file inputs when modal opens
            document.getElementById('banner-1-file').value = null;
            document.getElementById('banner-2-file').value = null;
            document.getElementById('banner-3-file').value = null;

            bannerModal.classList.remove('hidden');
        }

        window.closeBannerModal = function() {
            bannerModal.classList.add('hidden');
        }
        
        // Submission handler for the banner form (UNCHANGED)
        bannerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Array to hold promises for file processing
            const filePromises = [
                processFile(document.getElementById('banner-1-file'), 'banner_1_dataurl'),
                processFile(document.getElementById('banner-2-file'), 'banner_2_dataurl'),
                processFile(document.getElementById('banner-3-file'), 'banner_3_dataurl')
            ];

            try {
                // Wait for all files to be processed (or skipped/failed)
                const results = await Promise.all(filePromises);
                
                let changesMade = false;

                // results will be an array of objects: [{ key, dataUrl }, ...] or null for skipped
                results.forEach(result => {
                    if (result && result.dataUrl) {
                        localStorage.setItem(result.key, result.dataUrl);
                        changesMade = true;
                    } 
                    // Note: If no file is selected, the old dataUrl remains in local storage, which is the desired behavior.
                });

                if (!changesMade) {
                    showMessage("рдХреЛрдгрддреЗрд╣реА рдирд╡реАрди рдлреЛрдЯреЛ рдирд┐рд╡рдбрд▓реЗрд▓реЗ рдирд╛рд╣реАрдд. (No new photos selected)");
                    closeBannerModal();
                    return;
                }

                // Retrieve the latest Base64 data (newly saved or existing)
                const dataUrl1 = localStorage.getItem('banner_1_dataurl') || '';
                const dataUrl2 = localStorage.getItem('banner_2_dataurl') || '';
                const dataUrl3 = localStorage.getItem('banner_3_dataurl') || '';

                // Re-render the slider with new images
                updateBannerContent(dataUrl1, dataUrl2, dataUrl3);

                closeBannerModal();
                showMessage("рдмреЕрдирд░ рдлреЛрдЯреЛ рдпрд╢рд╕реНрд╡реАрд░рд┐рддреНрдпрд╛ рдЬрддрди рдХреЗрд▓реЗ! (Banner photos saved successfully!)");

            } catch (error) {
                // This catches the 100KB size validation error or file reading failure
                console.error("Banner upload error:", error);
                showMessage(`рдмреЕрдирд░ рдЬрддрди рдХрд░рддрд╛рдирд╛ рддреНрд░реБрдЯреА: ${error.message || 'рдлрд╛рдЗрд▓ рдЦреВрдк рдореЛрдареА рдЖрд╣реЗ.'}`, 5000);
            }
        });
        
        // Function to update banner content with new images (Base64 Data URLs) (UNCHANGED)
        function updateBannerContent(dataUrl1, dataUrl2, dataUrl3) {
            const slide1 = document.getElementById('slide-1');
            const slide2 = document.getElementById('slide-2');
            const slide3 = document.getElementById('slide-3');

            // Helper function to update slide content
            const setSlideImage = (slideElement, dataUrl, defaultText, defaultBg) => {
                slideElement.innerHTML = ''; // Clear existing content
                slideElement.style.backgroundImage = 'none'; // Reset background

                if (dataUrl) {
                    slideElement.style.backgroundImage = `url('${dataUrl}')`; // Use the Base64 Data URL
                    slideElement.style.backgroundSize = 'cover';
                    slideElement.style.backgroundPosition = 'center';
                    slideElement.style.backgroundColor = 'transparent'; // Reset background color
                    slideElement.classList.add('text-white', 'text-shadow');
                    // Add text overlay for clarity
                    slideElement.innerHTML = `
                        <div class="absolute inset-0 bg-black/40 flex flex-col items-center justify-center p-4">
                            <h2 class="text-xl font-extrabold mb-1">${defaultText}</h2>
                            <p class="text-sm font-medium">рддреБрдордЪрд╛ рдирд╡реАрди рдмреЕрдирд░ рдлреЛрдЯреЛ рдпреЗрдереЗ рджрд┐рд╕рдд рдЖрд╣реЗ.</p>
                        </div>
                    `;
                } else {
                    slideElement.style.backgroundImage = 'none';
                    slideElement.style.backgroundColor = defaultBg;
                    slideElement.classList.remove('text-shadow');
                    // Re-add default content if URL is empty
                    slideElement.innerHTML = `
                         <h2 class="text-xl font-extrabold mb-1">${defaultText}</h2>
                         <p class="text-sm font-medium">рдпреЗрдереЗ рддреБрдордЪрд╛ рдмреЕрдирд░ рдлреЛрдЯреЛ рдЬреЛрдбрд╛.</p>
                         <p class="text-xs mt-1 opacity-80">(рдХреНрд▓рд┐рдХ рдХрд░реВрди рдмреЕрдирд░ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрд┐рдд рдХрд░рд╛)</p>
                    `;
                }
            };

            setSlideImage(slide1, dataUrl1, 'рдкрд╣рд┐рд▓рд╛ рдмреЕрдирд░: рдореЛрдареА рдСрдлрд░!', 'var(--primary-green)');
            setSlideImage(slide2, dataUrl2, 'рджреБрд╕рд░рд╛ рдмреЕрдирд░: рдЦрд╛рд╕ рдЙрддреНрдкрд╛рджрди!', '#fbbf24'); // Yellow-600
            setSlideImage(slide3, dataUrl3, 'рддрд┐рд╕рд░рд╛ рдмреЕрдирд░: рд╕реВрдЪрдирд╛!', '#3b82f6'); // Blue-600
        }


        // --- EXISTING JAVASCRIPT LOGIC (MODIFIED FOR DOMContentLoaded) ---

        // Function to handle scroll events for sticky search bar (UNCHANGED)
        function handleScroll() {
            const primarySearchSection = document.getElementById('primary-search-section');
            const addressBtnCompact = document.getElementById('address-btn-compact');
            const stickySearchCompact = document.getElementById('sticky-search-compact');
            
            const primarySearchBottom = primarySearchSection.getBoundingClientRect().bottom;
            
            if (primarySearchBottom <= 0) {
                addressBtnCompact.classList.add('hidden');
                stickySearchCompact.classList.remove('hidden');
            } else {
                addressBtnCompact.classList.remove('hidden');
                stickySearchCompact.classList.add('hidden');
            }
        }
        
        // Sliding Banner Logic (UNCHANGED)
        const slider = document.getElementById('banner-slider');
        const dotsContainer = document.getElementById('slider-dots');
        let slides, totalSlides;
        let currentSlide = 0;

        function initializeSlider() {
            slides = slider.children;
            totalSlides = slides.length;
            
            // Load and apply initial banner images from local storage
            const dataUrl1 = localStorage.getItem('banner_1_dataurl') || '';
            const dataUrl2 = localStorage.getItem('banner_2_dataurl') || '';
            const dataUrl3 = localStorage.getItem('banner_3_dataurl') || '';
            updateBannerContent(dataUrl1, dataUrl2, dataUrl3);

            updateSlider();
            // Auto-slide functionality
            setInterval(() => { changeSlide(1); }, 5000); 
        }

        function updateSlider() {
            const offset = -currentSlide * 100;
            slider.style.transform = `translateX(${offset}%)`;
            updateDots();
        }

        window.changeSlide = function(direction) {
            currentSlide = (currentSlide + direction + totalSlides) % totalSlides;
            updateSlider();
        }

        function goToSlide(index) {
            currentSlide = index;
            updateSlider();
        }
        
        function updateDots() {
            dotsContainer.innerHTML = '';
            for (let i = 0; i < totalSlides; i++) {
                const dot = document.createElement('button');
                dot.className = `w-2 h-2 rounded-full transition-colors ${i === currentSlide ? 'bg-white scale-125' : 'bg-white bg-opacity-75'}`;
                dot.onclick = (e) => {
                    e.stopPropagation(); // Prevents dot click from opening the modal
                    goToSlide(i);
                }
                dotsContainer.appendChild(dot);
            }
        }

        // Address Modal Toggle Function (UNCHANGED)
        window.showAddressModal = function() {
            document.getElementById('address-modal').classList.remove('hidden');
        }

        // DOM Content Loaded Handler (ADDED PRODUCT FILE PREVIEW LISTENER)
        document.addEventListener('DOMContentLoaded', () => {
            initializeFirebase();
            initializeSlider();

            window.addEventListener('scroll', handleScroll);

            // Close address modal when clicking outside
            document.getElementById('address-modal').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) {
                    document.getElementById('address-modal').classList.add('hidden');
                }
            });

            // Category Button Click Logic (Existing, just shows message)
            document.querySelectorAll('.category-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const category = event.currentTarget.getAttribute('data-category');
                    showMessage(`рдЙрддреНрдкрд╛рджрдиреЗ рдЬреЛрдбрдгреНрдпрд╛рд╕рд╛рдареА ${category} рдкреЗрдЬрд╡рд░ рдЬрд╛рдд рдЖрд╣реЗ...`);
                });
            });
            
            // Add change listener to file inputs to show immediate preview in banner modal (UNCHANGED)
            ['banner-1-file', 'banner-2-file', 'banner-3-file'].forEach(id => {
                document.getElementById(id).addEventListener('change', function(event) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            setBannerPreview(id.replace('-file', ''), e.target.result);
                        };
                        reader.readAsDataURL(file);
                    }
                });
            });
            
            // NEW: Add product image file change listener for immediate preview
            document.getElementById('product-img-file').addEventListener('change', function(event) {
                const file = event.target.files[0];
                const imgEl = document.getElementById('product-img-tag');
                const textEl = document.getElementById('product-img-text');

                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        imgEl.src = e.target.result;
                        imgEl.classList.remove('hidden');
                        textEl.classList.add('hidden');
                    };
                    reader.readAsDataURL(file);
                } else {
                    imgEl.src = '';
                    imgEl.classList.add('hidden');
                    textEl.classList.remove('hidden');
                }
            });
        });

    </script>
</body>
</html>
